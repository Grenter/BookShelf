@using BookShelf.Shared.Model
@page "/books"
@inject HttpClient Http

<h1>@(displayAdd ? "Add Book" : "Books")</h1>

<div class="container">
    <div class="row">
        @if (!displayAdd)
        {
            <div class="col">
                <button onclick="@Reset" class="btn btn-danger float-right">Reset List</button>
                <button onclick="@Add" class="btn float-right">Add Book</button>
            </div>
        }
    </div>
</div>

@if (displayAdd)
{
    <AddBook />
}
else
{
    @if (books == null)
     {
         <p><em>Loading...</em></p>
     }
     else
     {
         <div class="container">
             <div class="row">
                 <div class="col">
                 </div>
                 <div class="col-6">
                     Title
                 </div>
                 <div class="col">
                     Authour(s)
                 </div>
                 <div class="col">
                     Shelf
                 </div>
             </div>
             <hr/>
             @foreach (var book in books)
             {
                 <div class="row">
                     <div class="col">
                         <img src="@book.CoverImage" class="cover-image"/>
                     </div>
                     <div class="col-6">
                         @book.Title
                     </div>
                     <div class="col">
                         @book.Authors
                     </div>
                     <div class="col">
                         @book.Shelf
                     </div>
                 </div>
             }
         </div>
     }
}

@functions
{
    List<Book> books;
    bool displayAdd = false;

    protected override async Task OnInitAsync()
    {
        await GetBooks();
    }

    async Task Reset()
    {
        books = null;
        var success = await Http.GetJsonAsync<bool>("https://uhguay2qye.execute-api.eu-west-2.amazonaws.com/Books/reset");

        if (success)
        {
            await GetBooks();
        }
    }

    async Task GetBooks()
    {
        books = await Http.GetJsonAsync<List<Book>>("https://uhguay2qye.execute-api.eu-west-2.amazonaws.com/Books/books");
    }

    void Add()
    {
        displayAdd = true;
    }
}
